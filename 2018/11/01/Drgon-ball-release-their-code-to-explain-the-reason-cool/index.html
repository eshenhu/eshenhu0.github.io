<!DOCTYPE html><html lang="en-Us"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="baidu-site-verification" content="1EB8XoOl0C"><title> Drgon ball release their code to explain the reason, cool · eshenhu's blog</title><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="Drgon ball release their code to explain the reason, cool - eshenhu"><meta name="keywords"><meta name="author" content="eshenhu"><link rel="short icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/bubuzou.css"><link rel="search" type="application/opensearchdescription+xml" href="https://eshenhu.github.io/atom.xml" title="eshenhu's blog"></head><body><header><div class="header row"> <a href="/" class="logo-link"><img src="/images/logo.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" data-hover="博文" class="nav-list-link">博文</a></li><li class="nav-list-item"><a href="/archives/" target="_self" data-hover="归档" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="/categories/live/" target="_self" data-hover="生活" class="nav-list-link">生活</a></li><li class="nav-list-item"><a href="/categories/film/" target="_self" data-hover="摄影" class="nav-list-link">摄影</a></li><li class="nav-list-item"><a href="/about/" target="_self" data-hover="关于" class="nav-list-link">关于</a></li></ul><div class="search"><a id="search_btn" href="#search"></a></div></div></header><div class="row scroll-con"><section class="container"><!-- for archive page--><div id="postAr" class="post"><article class="post-block"><h1 class="post-title">Drgon ball release their code to explain the reason, cool</h1><div class="post-info">2018-11-01 23:17</div><div class="post-content"><p>Today, I was surffing the web and saw a very interesting story about the players suspected the <em>Drogon Ball</em> game maker cheat on the game <a href="https://news.nicovideo.jp/watch/nw3072710" target="_blank" rel="noopener">here</a> and <a href="https://dbz-dokkan.bngames.net/info1116.html" target="_blank" rel="noopener">here</a> </p>
<p><em>Dragon Ball</em> finally release their code to explain the reason, which is really <em>HACKER</em> way. I like it. In now days, as a player, you<br>need not only the crack skills as before, but also some basic code skills. :-) </p>
<p>About the problem:</p>
<blockquote>
<p>In the game application “ Dragon Ball Z Dokkan Battle “ there was a typographical mistake in some gacha and the influence \”There might have been a character that does not appear for each user (whether there was a wrong setting)” According to the problem being said, the management side explained “by mistake of notation”. However, the source code has been released this time whether the riot did not fit. </p>
</blockquote>
<img src="/2018/11/01/Drgon-ball-release-their-code-to-explain-the-reason-cool/info1116_01.png" title="c++code">
<a id="more"></a>
<p>Some points were here:</p>
<ul>
<li><em>Dragon Ball</em> partly use C++ 11 as their back-end system.</li>
<li><em>Dragon Ball</em> use <code>cache</code> system to cache the CardId for players.</li>
<li>If cache was missed, then the function will lookup the data in back-end Sqlite. </li>
<li>The return value <code>result</code> will RVO(Return Value Opti) by the compiler, so no copy will happened between caller and callee. </li>
</ul>
<p>The problem caused by the Sql query and following handling branch.</p>
<p>Beside the logical error, some improvements could be:</p>
<ul>
<li>Line 3 and Line 4 can be optimized in one line during <em>constructor</em>, it will be better if</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">vector</span>&lt;CardDataPtr&gt; result(masterCardIds.size());</div></pre></td></tr></table></figure>
<ul>
<li>All the self-incremental operation can be optimized by “++i” instead of “i++”.</li>
<li><p>I am thinking the number of players will be dynamic changed, f.g. in the weekend or the evening, the player will be more than normal, assume <em>cache</em> system use <em>LRU</em> to do update, if the <em>cache</em> was not quite config well, f.g. the size was config with a relative small value comparing with number of players, it means this function will mostly lookup the value to the sqlite, Sqlite will be busy during this time, in some worse-case scenario, it will dramaticlly decrease the performance of the system.</p>
<p> So, the <em>cache</em> system should know about this, increase the capacity to cache more data than normal, it means it was needed to emit a performance counter data to the <em>monitor</em> system between the block 1 and block 2 in the picture to tell how frequency of <em>Query</em> request for CardData, later system tuning will be considered if some system bottleneck was happened.</p>
</li>
</ul>
<p>Finally, I like the working way of <em>Dragon Ball</em> exposing the problem. It is cool.</p>
</div></article></div><div class="right-container"><div class="widget"><div class="category"><h4>分类归档</h4></div></div><div class="widget"><div class="tagcloud"><h4>标签云</h4><a href="/tags/Language/" style="font-size: 10px;">Language</a> <a href="/tags/Linux-Kernel-Module/" style="font-size: 10px;">Linux Kernel Module</a> <a href="/tags/Qualcomm/" style="font-size: 10px;">Qualcomm,</a> <a href="/tags/SIPTO-LIPA-IMobile-Data-Offloading/" style="font-size: 10px;">SIPTO LIPA IMobile Data Offloading</a> <a href="/tags/golang/" style="font-size: 10px;">golang</a></div></div><div class="widget"><div class="recent"><h4>最近文章</h4><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/02/18/Golang-race-condition-detection-result-will-not-happene-always/">Golang-race-condition-detection-result-will-not-happene-always</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/05/SMEM-SMD-SMSM-1-3/">SMEM,SMD,SMSM 1/3</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/01/Drgon-ball-release-their-code-to-explain-the-reason-cool/">Drgon ball release their code to explain the reason, cool</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/12/Write-a-HW-based-periodic-timer-framework/">Write a HW based periodic timer framework</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/22/Use-DPDK-to-accelerate-LTE-networks/">Use DPDK to accelerate LTE networks</a></li></ul></div></div><div class="widget"><div id="arAnchorBar"></div></div></div></section></div><div class="right-menu"></div><div class="modal search-modal"><div class="input-field"><input type="text" id="search_input"><label for="search-input">搜索</label></div><div id="search_result" class="search-result"></div></div><div class="blog-overlay"></div><footer class="row"><div class="footer-con"><div class="paginator"><a href="/2018/12/05/SMEM-SMD-SMSM-1-3/" class="prev">PREV</a><a href="/2018/08/12/Write-a-HW-based-periodic-timer-framework/" class="next">NEXT</a></div><div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div><script>var cloudTieConfig = {
    url: document.location.href, 
    sourceId: "",
    productKey: "656e246ebfc7420d82eb5d9a339b50c2",
    target: "cloud-tie-wrapper"
};</script><script src="https://img1.cache.netease.com/f2e/tie/yun/sdk/loader.js"></script><div class="copyright"><p>© 2016 - 2019 <a target="_blank">eshenhu</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> <br> and <a href="https://github.com/Bulandent/hexo-theme-bubuzou" target="_blank">hexo-theme-bubuzou</a>.</p></div><div class="totop"><i></i></div></div></footer><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script src="/scripts/jquery-1.8.2.min.js"></script><script src="/scripts/arAnchor.js"></script><script src="/scripts/main.js"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>
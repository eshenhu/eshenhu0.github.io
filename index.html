<!DOCTYPE html><html lang="en-Us"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="baidu-site-verification" content="1EB8XoOl0C"><title> eshenhu's blog</title><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="It never be later than do nothing"><meta name="keywords"><meta name="author" content="eshenhu"><link rel="short icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/bubuzou.css"><link rel="search" type="application/opensearchdescription+xml" href="https://eshenhu.github.io/atom.xml" title="eshenhu's blog"></head><body><header><div class="header row"> <a href="/" class="logo-link"><img src="/images/logo.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" data-hover="博文" class="nav-list-link">博文</a></li><li class="nav-list-item"><a href="/archives/" target="_self" data-hover="归档" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="/categories/live/" target="_self" data-hover="生活" class="nav-list-link">生活</a></li><li class="nav-list-item"><a href="/categories/film/" target="_self" data-hover="摄影" class="nav-list-link">摄影</a></li><li class="nav-list-item"><a href="/about/" target="_self" data-hover="关于" class="nav-list-link">关于</a></li></ul><div class="search"><a id="search_btn" href="#search"></a></div></div></header><div class="row scroll-con"><section class="container"><!-- for archive page--><ul class="home post-list"><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2019/02/18/Golang-race-condition-detection-result-will-not-happene-always/" class="post-title-link">Golang-race-condition-detection-result-will-not-happene-always</a></h2><div class="post-info">2019-02-18 21:49</div><div class="post-content"><p>[TOC]</p>
<p>Dave Cheney post a <a href="https://dave.cheney.net/2015/11/18/wednesday-pop-quiz-spot-the-race" target="_blank" rel="noopener">quiz</a> on his blog several years ago, </p>
<p><a href="http://play.golang.org/p/tjN4I_VTV0" target="_blank" rel="noopener">code</a></p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">        <span class="string">"fmt"</span></div><div class="line">        <span class="string">"time"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="keyword">type</span> RPC <span class="keyword">struct</span> &#123;</div><div class="line">        result <span class="keyword">int</span></div><div class="line">        done   <span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rpc *RPC)</span> <span class="title">compute</span><span class="params">()</span></span> &#123;</div><div class="line">        time.Sleep(time.Second) <span class="comment">// strenuous computation intensifies</span></div><div class="line">        rpc.result = <span class="number">42</span></div><div class="line">        <span class="built_in">close</span>(rpc.done)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(RPC)</span> <span class="title">version</span><span class="params">()</span> <span class="title">int</span></span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span> <span class="comment">// never going to need to change this</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">        rpc := &amp;RPC&#123;done: <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)&#125;</div><div class="line"></div><div class="line">        <span class="keyword">go</span> rpc.compute()         <span class="comment">// kick off computation in the background</span></div><div class="line">        version := rpc.version() <span class="comment">// grab some other information while we're waiting</span></div><div class="line">        &lt;-rpc.done               <span class="comment">// wait for computation to finish</span></div><div class="line">        result := rpc.result</div><div class="line"></div><div class="line">        fmt.Printf(<span class="string">"RPC computation complete, result: %d, version: %d\n"</span>, result, version)</div><div class="line">&#125;</div></pre></td></tr></table></figure></div><a href="/2019/02/18/Golang-race-condition-detection-result-will-not-happene-always/" class="read-more">...more</a></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2018/12/05/SMEM-SMD-SMSM-1-3/" class="post-title-link">SMEM,SMD,SMSM 1/3</a></h2><div class="post-info">2018-12-05 22:58</div><div class="post-content"><h1 id="SMEM-SMD-SMSM-1-3"><a href="#SMEM-SMD-SMSM-1-3" class="headerlink" title="SMEM,SMD,SMSM (1/3)"></a>SMEM,SMD,SMSM (1/3)</h1><p>Recent half of year, I made development on Qualcomm platform FSM990x, which is ARM A7 based, same core with Mobile phone a few years ago, but equipped with more powerful DSP and FPGA capability for special purpose.</p>
<p>In the Qualcomm SDK, there are some concepts which need to be learned with some effort. I had like share my thoughts on SMEM, SMD,SMSM and QMI in following series of articles.</p>
<h2 id="Concept"><a href="#Concept" class="headerlink" title="Concept"></a>Concept</h2><p>In the Kernel tree, there is a brief introduction on SMEM,SMD,SMSM in the soc/qcom/qcom,smem.txt, But it has little hard to understand what is the purpose and usage on SMEM,SMD,SMSM in Qualcomm platform, I’d like share my thought on this topic.</p>
<p>@<a href="https://elixir.bootlin.com/linux/v4.4.97/source/Documentation/devicetree/bindings/soc/qcom/qcom,smem.txt" target="_blank" rel="noopener">SMEM</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Qualcomm Shared Memory Manager binding</div><div class="line">This binding describes the Qualcomm Shared Memory Manager, used to share data</div><div class="line">between various subsystems and OSes in Qualcomm platforms.</div></pre></td></tr></table></figure></p>
<p>@<a href="https://elixir.bootlin.com/linux/v4.4.97/source/Documentation/devicetree/bindings/soc/qcom/qcom,smd.txt" target="_blank" rel="noopener">SMD</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Qualcomm Shared Memory Driver (SMD) binding</div><div class="line"></div><div class="line">This binding describes the Qualcomm Shared Memory Driver, a fifo based</div><div class="line">communication channel for sending data between the various subsystems in</div><div class="line">Qualcomm platforms.</div></pre></td></tr></table></figure></p></div><a href="/2018/12/05/SMEM-SMD-SMSM-1-3/" class="read-more">...more</a></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2018/11/01/Drgon-ball-release-their-code-to-explain-the-reason-cool/" class="post-title-link">Drgon ball release their code to explain the reason, cool</a></h2><div class="post-info">2018-11-01 23:17</div><div class="post-content"><p>Today, I was surffing the web and saw a very interesting story about the players suspected the <em>Drogon Ball</em> game maker cheat on the game <a href="https://news.nicovideo.jp/watch/nw3072710" target="_blank" rel="noopener">here</a> and <a href="https://dbz-dokkan.bngames.net/info1116.html" target="_blank" rel="noopener">here</a> </p>
<p><em>Dragon Ball</em> finally release their code to explain the reason, which is really <em>HACKER</em> way. I like it. In now days, as a player, you<br>need not only the crack skills as before, but also some basic code skills. :-) </p>
<p>About the problem:</p>
<blockquote>
<p>In the game application “ Dragon Ball Z Dokkan Battle “ there was a typographical mistake in some gacha and the influence \”There might have been a character that does not appear for each user (whether there was a wrong setting)” According to the problem being said, the management side explained “by mistake of notation”. However, the source code has been released this time whether the riot did not fit. </p>
</blockquote>
<img src="/2018/11/01/Drgon-ball-release-their-code-to-explain-the-reason-cool/info1116_01.png" title="c++code"></div><a href="/2018/11/01/Drgon-ball-release-their-code-to-explain-the-reason-cool/" class="read-more">...more</a></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2018/08/12/Write-a-HW-based-periodic-timer-framework/" class="post-title-link">Write a HW based periodic timer framework</a></h2><div class="post-info">2018-08-12 16:12</div><div class="post-content"><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>   Linux kernel provided good readable timer operations in the code. <a href="https://linux.die.net/man/7/time" target="_blank" rel="noopener">ref timer</a></p>
<p>   Some attributes of system timer in the kernel are:<br>   1) It was not designed for time-critical kernel modules, as it takes much works during the tick, such like <em>update jiffies</em>, <em>process accounting</em>, <em>RCU callback</em>, _irq_work_etc.<br>   2) Some throughput cared system was configed in the kernel configration with “NOHZ” option,<br>   Invoke the tick during the “IDLE” state will offset the impact of the kernel “NOHZ” configration. We just want to invoke the callback instead of wake up other staffs.<br>   3) Nearly all the embedded SoC have their design with 2 or more counter-based HW<br>   timers, it was not wise design binding the periodic work to the system timer.</p></div><a href="/2018/08/12/Write-a-HW-based-periodic-timer-framework/" class="read-more">...more</a></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2018/05/22/Use-DPDK-to-accelerate-LTE-networks/" class="post-title-link">Use DPDK to accelerate LTE networks</a></h2><div class="post-info">2018-05-22 18:51</div><div class="post-content"><p>Along with the revolution of FlexRAN, the Tele was required to provide more flexible services to the customers. One of them is Tele want to provide more customsize services to the paticular users, such like Oil, Medical etc manufacture industries, who want intergrate more industried services within some fixed area. Both the internet Cloud companies and Tele companies want to share this market.</p>
<p>This reqiures the tradition tele companies adaping to the fast market, utilizing their advantages to make the profits. They also want to manager the networks services in one platform to decrease the investment, f.g. In the scenario above, Tele need to deploy the traffic offloading service in the edge network for saving the time latency, or intergrate the core network services in the nearby edge LTE/5G eNodeB equipment.</p>
<h1 id="New-platform"><a href="#New-platform" class="headerlink" title="New platform"></a>New platform</h1><p>We cooperate with Intel to make some typical x86 platforms to make tries on these area, and make some progress on how to mano the sevices under different scenarios.</p>
<p>Intel Atom C3K is one of our lowcost platform, we experience eNodeB/EPC network service on this platform.</p></div><a href="/2018/05/22/Use-DPDK-to-accelerate-LTE-networks/" class="read-more">...more</a></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2018/05/16/build-lightweight-network-monitor-tools/" class="post-title-link">build lightweight network monitor tools</a></h2><div class="post-info">2018-05-16 23:14</div><div class="post-content"><h1 id="Motivation"><a href="#Motivation" class="headerlink" title="Motivation"></a>Motivation</h1><p>Recently my project need a lightweight network monitor tools to peek at the network activity, some basic requirements was list as following:</p>
<ul>
<li>Provide basic network/interface SDK to the application.</li>
<li>The service need provide the report on activities on the network, like <ul>
<li>interface modification, add/del/modify including ip changes, mac changes, new interface added, etc</li>
<li>network connectiong status, stale/reachable</li>
</ul>
</li>
<li>Extensibility and decouple serive and client, easy to intergrate other service. </li>
<li>Lightweight, less CPU usage and memory usage.</li>
</ul>
<p>After google some open source projects, I found it seems like no one can fit my requirement, but the iproute2 project was quite fit my requirement. So, why we don’t make iproute2 as a library?</p>
<p>I list the <em>Pros</em> and <em>Cons</em> if use iproute2 as library:</p>
<p>Pros:</p>
<ul>
<li>No need to write the socket layer code.</li>
<li>More or even more information about network interfaces can be got. Same functionality with the iproute2 tools.</li>
<li>Simple API interface.</li>
</ul>
<p>Cons:</p>
<ul>
<li>iproute2-as-lib library size is big. ~500kb.</li>
</ul>
<p>GitHub:<br>  <a href="https://github.com/eshenhu/iproute2_as_lib" target="_blank" rel="noopener">iprout2_as_lib</a></p>
<p>Enjoy it!<br></p></div><a href="/2018/05/16/build-lightweight-network-monitor-tools/" class="read-more">...more</a></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2017/12/28/Build-your-private-LTE-network-for-IIOT/" class="post-title-link">Build your private LTE network for IIOT</a></h2><div class="post-info">2017-12-28 17:15</div><div class="post-content"><p><em>Abstract</em>:</p>
<blockquote>
<p>In some specfied conditions, the tele operator is considering share/reserve some spectrum resource to the IIOT(Industry IoT)applicance, like the NB-IoT/eMTC tech defined by 3GPP stardard.<br>In this article, we present a solution on how to offload LTE with Selected IP tracffic offload(SIPTO) tech, which provide another practical solution beside the traditional LTE macro cell deployment. This deployment will save the investment and simplify the Network Element deloyment, as well as increase the KPI in local factory.</p>
</blockquote>
<p><em>Keywords</em>: SIPTO, LIPA, IMobile Data Offloading</p>
<h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>With the increase of cost spent in thse back-haul equipment(either in the urban area or in the low-intensity population area), more and more operator will like consider using the existed cable provider (like Comcast in US) as their back-haul alternatively. Specially FTTH and other PON technology become more and more popular, cable operator can provide relatively high QoS now.</p>
<p>3GPP present the TS23.829 as the guide to the HeNB manufacture how to deploy the off-load infrastructure cooperating with the macro cell to reach the best experience to the end-user. </p>
<p>Along with the population of Industry 4.0 and edge-computing, more and more geography-fixed device has the requirement to access the network with QoS and throughput. Specially in the smart-factory setup,  they want to rent the telcomm wireless network within their factory-domain or running their owned private wireless network.<br>Specially, the vCPEs in the same eNodeB want to intercommunicate to each other, which means the traffic happened between those vCPEs will not route outside of local domain. for example, in the steaming video like IPTV services in the set-top box, each app was used with P2P technology, locate gateway offloading and vCPEs interconnection each other is a big cons to the end-user’s experience.<br>In some industry area, the end sensors, robots or equipments will generate huge data per day, the factory owner will be careful to consider use, like LTE network as their connecting method. even most of data will not access outside of factory.<br>With this kind of deloyment, the operator will reduce stress on the network and make better profit on the IIoT revolution.</p>
<img src="/2017/12/28/Build-your-private-LTE-network-for-IIOT/00_network_deployment.png" title="network_deployment">
<p>As a summary, some characters were:</p>
<ul>
<li>SON (automatically select the proper wireless configuration)</li>
<li>Traffic local Gateway offloading.</li>
<li>vCPE inter accessibility in the eNodeBs managed by a same LGW.</li>
</ul></div><a href="/2017/12/28/Build-your-private-LTE-network-for-IIOT/" class="read-more">...more</a></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2017/11/22/Build-service-with-SOA-in-Openwrt/" class="post-title-link">Build service with SOA in Openwrt</a></h2><div class="post-info">2017-11-22 18:51</div><div class="post-content"><p>In one of internal technical review meeting, the coder integrate the service into a existed substance/service, but considering of the scalability of this service, I strongly recommended the developer decouple this service from any substance and made them into a self-contained substance in order to provide the service to more clients in the future. </p>
<p>##SOA in practice<br> In the wikipedia <a href="https://en.wikipedia.org/wiki/Service-oriented_architecture" target="_blank" rel="noopener">page</a>, SOA was needed to meet the following basic rules.</p>
<blockquote>
<p>A service has four properties according to one of many definitions of SOA:</p>
<ul>
<li>It logically represents a business activity with a specified outcome.</li>
<li>It is self-contained.</li>
<li>It is a black box for its consumers.</li>
<li>It may consist of other underlying services.</li>
</ul>
</blockquote>
<p>In the resource-limited SoC, it maybe not practical to deploy individual service with one standalone process,  but it will be possible deploying partly/all services in one process and multiplexed the service using the different domain/interface id.<br></p></div><a href="/2017/11/22/Build-service-with-SOA-in-Openwrt/" class="read-more">...more</a></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2017/11/02/Design-a-license-system-in-embedded-system/" class="post-title-link">Design a license system in embedded system</a></h2><div class="post-info">2017-11-02 18:14</div><div class="post-content"><blockquote>
<p><code>License</code> was widely used on many software/hardware area, such as Microsoft Windows Series, which use dedicated hardware to store their key and other information to verify the booting OS is legal or not. Dell or EMC or Oracle Database use license to limit how many HW resource can be used. So, <code>license</code> system is an valuable assert to the company as it can bring the direct profit.</p>
</blockquote>
<h2 id="Aspects-when-designing-license-system"><a href="#Aspects-when-designing-license-system" class="headerlink" title="Aspects when designing license system"></a>Aspects when designing license system</h2><ul>
<li>Security</li>
<li>Compatible </li>
</ul>
<h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><p>In common, the company would like to design a universal HW platform to carry on different requirements with the reason of decreasing the complex of BOM, leverage the cost on HW expense, etc. In order to make more profit on a universal hardware platform, then you need a license system to give the right authority to your sales/customer. For example, in the wireless system, some company would like sale the HW without any charge or very low price, but those HW only can carry on low volume data/service in the <code>BASIC</code> state, f.g. LTE station in <code>BASIC</code> mode only can take 16 Users in one BST,  a limited throughput, a limited Cells can be setup. Basically,  you had to buy a suitable license paper meeting your requirement, just like the menu in the restaurant, you can’t image how many menus did the company make ready for you.<br>In one word, License can make money!!!</p></div><a href="/2017/11/02/Design-a-license-system-in-embedded-system/" class="read-more">...more</a></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2017/10/23/Fast-logging-system-in-embedded-system/" class="post-title-link">Fast logging system in embedded system</a></h2><div class="post-info">2017-10-23 21:04</div><div class="post-content"><h1 id="Fast-logging-system-in-embedded-system"><a href="#Fast-logging-system-in-embedded-system" class="headerlink" title="Fast logging system in embedded system"></a>Fast logging system in embedded system</h1><hr>
<p>[TOC]</p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>FLOG is a light-weight logging system which has features like, high throughput, non-blocking and lock-less write from different process, crash save in field. It is suitable for the embedded system using Linux system.</p>
<h2 id="Log-VS-Trace"><a href="#Log-VS-Trace" class="headerlink" title="Log VS. Trace"></a>Log VS. Trace</h2><p><strong>Log</strong> was used as recording the activity on subsystem, it provide the activity information to the system administrator or operator to give them a preview on the activity. such as booting information when kernel boot, plug-in-plug-out event popup by kernel.</p>
<img src="/2017/10/23/Fast-logging-system-in-embedded-system/log_sample.png" title="Picture-01">
<p><strong>Trace</strong> was used as recording detailed information on specified system, its main purpose is used as tracking the detail into this system, the output which it generate was used by programmer to analysis what is going on when some problem happened. In common occurrence, it only be requested when system was not working as expected, such as the throughput was not reached into the theory level in wireless card, etc.</p></div><a href="/2017/10/23/Fast-logging-system-in-embedded-system/" class="read-more">...more</a></article></li></ul><div class="right-container"><div class="widget"><div class="category"><h4>分类归档</h4></div></div><div class="widget"><div class="tagcloud"><h4>标签云</h4><a href="/tags/Language/" style="font-size: 10px;">Language</a> <a href="/tags/Linux-Kernel-Module/" style="font-size: 10px;">Linux Kernel Module</a> <a href="/tags/Qualcomm/" style="font-size: 10px;">Qualcomm,</a> <a href="/tags/SIPTO-LIPA-IMobile-Data-Offloading/" style="font-size: 10px;">SIPTO LIPA IMobile Data Offloading</a> <a href="/tags/golang/" style="font-size: 10px;">golang</a></div></div><div class="widget"><div class="recent"><h4>最近文章</h4><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/02/18/Golang-race-condition-detection-result-will-not-happene-always/">Golang-race-condition-detection-result-will-not-happene-always</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/05/SMEM-SMD-SMSM-1-3/">SMEM,SMD,SMSM 1/3</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/01/Drgon-ball-release-their-code-to-explain-the-reason-cool/">Drgon ball release their code to explain the reason, cool</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/12/Write-a-HW-based-periodic-timer-framework/">Write a HW based periodic timer framework</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/22/Use-DPDK-to-accelerate-LTE-networks/">Use DPDK to accelerate LTE networks</a></li></ul></div></div><div class="widget"><div id="arAnchorBar"></div></div></div></section></div><div class="right-menu"></div><div class="modal search-modal"><div class="input-field"><input type="text" id="search_input"><label for="search-input">搜索</label></div><div id="search_result" class="search-result"></div></div><div class="blog-overlay"></div><footer class="row"><div class="footer-con"><div class="paginator"><a href="/page/2/" class="next">NEXT</a></div><div class="copyright"><p>© 2016 - 2019 <a target="_blank">eshenhu</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> <br> and <a href="https://github.com/Bulandent/hexo-theme-bubuzou" target="_blank">hexo-theme-bubuzou</a>.</p></div><div class="totop"><i></i></div></div></footer><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script src="/scripts/jquery-1.8.2.min.js"></script><script src="/scripts/arAnchor.js"></script><script src="/scripts/main.js"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>